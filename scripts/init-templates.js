const Database = require('better-sqlite3');
const path = require('path');

// 连接数据库 - 使用与应用程序相同的路径逻辑
const appPath = path.join(__dirname, '..');
const dataDir = path.join(path.dirname(appPath), 'data');
const dbPath = path.join(dataDir, 'database.db');
console.log('数据库路径:', dbPath);
const db = new Database(dbPath);

// 设置SQLite使用UTF-8编码
db.pragma('encoding = "UTF-8"');
console.log('SQLite编码设置为UTF-8');

// 预设模板数据
const templates = [
  {
    name: '教案模板',
    description: '标准教案格式模板',
    category: '常用模板',
    content: `# 教案模板

## 基本信息
- 课程名称：
- 授课班级：
- 授课时间：
- 授课教师：

## 教学目标
### 知识目标

### 能力目标

### 情感目标

## 教学重点

## 教学难点

## 教学方法

## 教学过程
### 导入环节（5分钟）

### 新课讲授（25分钟）

### 巩固练习（10分钟）

### 课堂小结（5分钟）

## 板书设计

## 作业布置

## 教学反思`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '课程计划',
    description: '学期课程教学计划模板',
    category: '常用模板',
    content: `# 课程教学计划

## 课程基本信息
- 课程名称：
- 适用年级：
- 学期：
- 总课时：

## 学情分析

## 教学目标
### 总体目标

### 分阶段目标

## 教学内容安排
### 第一单元
- 教学内容：
- 课时安排：
- 重点难点：

### 第二单元
- 教学内容：
- 课时安排：
- 重点难点：

## 教学进度计划
| 周次 | 教学内容 | 课时 | 备注 |
|------|----------|------|------|
| 1 | | | |
| 2 | | | |

## 评价方式

## 教学资源`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '家长会通知',
    description: '家长会通知书模板',
    category: '常用模板',
    content: `# 家长会通知

尊敬的家长：

您好！为了加强家校沟通，共同关注孩子的成长，我校定于举行家长会。

## 会议信息
- **时间**：年月日（星期）下午
- **地点**：
- **参会对象**：全体家长

## 会议议程
1. 班级情况汇报
2. 学生学习情况分析
3. 家校合作事宜
4. 家长交流讨论

## 注意事项
1. 请家长准时参加
2. 会议期间请将手机调至静音
3. 如有特殊情况无法参加，请提前联系班主任

## 联系方式
- 班主任：
- 联系电话：

期待您的参与！

班主任：
年月日`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '班级通讯录',
    description: '班级学生及家长联系方式',
    category: '快速生成',
    content: `# 班级通讯录

**班级**：
**班主任**：
**联系电话**：

## 学生信息

| 序号 | 学号 | 姓名 | 性别 | 家长姓名 | 联系电话 | 家庭住址 | 备注 |
|------|------|------|------|----------|----------|----------|------|
| 1 | | | | | | | |
| 2 | | | | | | | |
| 3 | | | | | | | |
| 4 | | | | | | | |
| 5 | | | | | | | |

## 紧急联系人

| 姓名 | 职务 | 联系电话 | 备注 |
|------|------|----------|------|
| | 校长 | | |
| | 教务主任 | | |
| | 年级组长 | | |

**更新日期**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '学生花名册',
    description: '班级学生基本信息登记',
    category: '快速生成',
    content: `# 学生花名册

**学校**：
**年级**：
**班级**：
**班主任**：
**学期**：

## 学生基本信息

| 序号 | 学号 | 姓名 | 性别 | 出生日期 | 民族 | 家庭住址 | 家长姓名 | 联系电话 | 备注 |
|------|------|------|------|----------|------|----------|----------|----------|------|
| 1 | | | | | | | | | |
| 2 | | | | | | | | | |
| 3 | | | | | | | | | |
| 4 | | | | | | | | | |
| 5 | | | | | | | | | |

## 统计信息
- **总人数**：人
- **男生**：人
- **女生**：人

**填表人**：
**填表日期**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '座位表',
    description: '班级学生座位安排',
    category: '快速生成',
    content: `# 班级座位表

**班级**：
**学期**：
**制表日期**：

## 座位安排图

\`\`\`
讲台
┌─────────────────────────────────┐
│                                 │
└─────────────────────────────────┘

第一排
┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐
│     │  │     │  │     │  │     │
│  1  │  │  2  │  │  3  │  │  4  │
│     │  │     │  │     │  │     │
└─────┘  └─────┘  └─────┘  └─────┘

第二排
┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐
│     │  │     │  │     │  │     │
│  5  │  │  6  │  │  7  │  │  8  │
│     │  │     │  │     │  │     │
└─────┘  └─────┘  └─────┘  └─────┘
\`\`\`

## 座位名单

| 座位号 | 姓名 | 备注 |
|--------|------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |

**班主任**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '字帖模板',
    description: '汉字练字字帖模板',
    category: '快速生成',
    content: `# 汉字练字字帖

**练习日期**：
**练习内容**：

## 练字要求
1. 坐姿端正，握笔正确
2. 仔细观察字的结构
3. 先描红，再临摹，最后独立书写

## 练习字词

### 第一组
┌─────┬─────┬─────┬─────┐
│     │     │     │     │
│  描  │  红  │  临  │  写  │
│     │     │     │     │
└─────┴─────┴─────┴─────┘

### 第二组
┌─────┬─────┬─────┬─────┐
│     │     │     │     │
│     │     │     │     │
│     │     │     │     │
└─────┴─────┴─────┴─────┘

## 评价
- **书写姿势**：□优秀 □良好 □需改进
- **字体工整**：□优秀 □良好 □需改进
- **结构准确**：□优秀 □良好 □需改进

**教师评语**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '练习题模板',
    description: '各科练习题生成模板',
    category: '快速生成',
    content: `# 练习题

**科目**：
**年级**：
**姓名**：
**日期**：

## 一、选择题（每题5分，共30分）

1. 
   A.    B.    C.    D.

2. 
   A.    B.    C.    D.

3. 
   A.    B.    C.    D.

## 二、填空题（每空3分，共30分）

1. ________是________的________。

2. 根据题意填空：________。

3. 计算结果：________ = ________。

## 三、简答题（每题10分，共40分）

1. 


2. 


3. 


4. 


**总分**：_____分`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '英语听写纸',
    description: '英语单词听写练习',
    category: '快速生成',
    content: `# English Dictation

**Name**: ________________  **Class**: ________________
**Date**: ________________   **Score**: _______________

## Instructions
- Listen carefully to each word
- Write the word clearly
- Check your spelling

## Word List

1. ________________________

2. ________________________

3. ________________________

4. ________________________

5. ________________________

6. ________________________

7. ________________________

8. ________________________

9. ________________________

10. _______________________

## Sentences

1. _________________________________________________
   _________________________________________________

2. _________________________________________________
   _________________________________________________

3. _________________________________________________
   _________________________________________________

**Teacher Comments**: 


**Signature**: ________________`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '出勤统计表',
    description: '班级学生出勤情况统计',
    category: '统计报表',
    content: `# 班级出勤统计表

**班级**：
**统计周期**：年月日 至 年月日
**统计员**：

## 出勤情况统计

| 序号 | 姓名 | 应到天数 | 实到天数 | 迟到次数 | 早退次数 | 请假天数 | 旷课天数 | 出勤率 |
|------|------|----------|----------|----------|----------|----------|----------|--------|
| 1 | | | | | | | | |
| 2 | | | | | | | | |
| 3 | | | | | | | | |
| 4 | | | | | | | | |
| 5 | | | | | | | | |

## 汇总统计
- **班级总人数**：人
- **平均出勤率**：%
- **全勤人数**：人
- **迟到总次数**：次
- **请假总天数**：天

## 出勤情况分析


## 改进措施


**班主任签字**：
**统计日期**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '成绩分析报告',
    description: '班级考试成绩分析',
    category: '统计报表',
    content: `# 班级成绩分析报告

**班级**：
**考试名称**：
**考试时间**：
**分析人**：

## 成绩概况
- **参考人数**：人
- **平均分**：分
- **最高分**：分
- **最低分**：分
- **及格率**：%
- **优秀率**：%

## 成绩分布

| 分数段 | 人数 | 百分比 | 姓名 |
|--------|------|--------|------|
| 90-100 | | | |
| 80-89 | | | |
| 70-79 | | | |
| 60-69 | | | |
| 60以下 | | | |

## 各题得分情况

| 题号 | 题型 | 满分 | 平均分 | 得分率 | 主要问题 |
|------|------|------|--------|--------|----------|
| 1 | | | | | |
| 2 | | | | | |
| 3 | | | | | |

## 问题分析

### 主要问题

### 原因分析

## 改进措施

### 教学改进

### 学生指导

**分析日期**：`,
    is_system: 1,
    is_active: 1
  },
  {
    name: '班级总结',
    description: '班级学期工作总结',
    category: '统计报表',
    content: `# 班级工作总结

**班级**：
**学期**：
**班主任**：
**总结时间**：

## 班级基本情况
- **班级人数**：人（男生人，女生人）
- **班干部情况**：
- **学习氛围**：

## 本学期工作回顾

### 德育工作
#### 主要活动

#### 取得成效

### 学习管理
#### 学习成绩

#### 学习习惯培养

### 班级管理
#### 班级制度建设

#### 班干部培养

### 家校合作
#### 家长会情况

#### 家访情况

## 取得的成绩

### 集体荣誉

### 个人荣誉

### 进步表现

## 存在的问题

### 学习方面

### 纪律方面

### 其他问题

## 原因分析

## 下学期工作计划

### 工作目标

### 具体措施
1. 德育工作

2. 学习管理

3. 班级建设

4. 家校合作

## 工作反思


**班主任签名**：
**总结日期**：`,
    is_system: 1,
    is_active: 1
  }
];

// 插入模板数据
const insertTemplate = db.prepare(`
  INSERT INTO document_templates (name, description, category, template_content, fields, file_type, is_system, is_active, created_by)
  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
`);

console.log('开始插入模板数据...');

try {
  db.transaction(() => {
    for (const template of templates) {
      insertTemplate.run(
        template.name,
        template.description,
        template.category,
        JSON.stringify({ content: template.content }),
        JSON.stringify([]),
        'pdf',
        template.is_system,
        template.is_active,
        1
      );
      console.log(`已插入模板: ${template.name}`);
    }
  })();
  
  console.log(`\n成功插入 ${templates.length} 个模板！`);
  
  // 验证插入结果
  const count = db.prepare('SELECT COUNT(*) as count FROM document_templates WHERE is_system = 1').get();
  console.log(`数据库中共有 ${count.count} 个系统模板`);
  
} catch (error) {
  console.error('插入模板时出错:', error);
} finally {
  db.close();
}

console.log('模板初始化完成！');
# 数据库迁移说明

## 🔄 迁移概述

此次更新将数据库从系统用户目录迁移到软件安装目录，方便整个应用程序的移动和复制。

## 📁 路径变更

### 之前的数据库位置
- Windows: `%APPDATA%/changxiang-teacher/database.db`
- macOS: `~/Library/Application Support/changxiang-teacher/database.db`
- Linux: `~/.config/changxiang-teacher/database.db`

### 现在的数据库位置
- 开发环境: `./data/database.db` （项目根目录下的data文件夹）
- 生产环境: `[应用安装目录]/data/database.db`

## ✅ 修改的文件

1. **`src/main/database.ts`** - 主程序数据库配置
   - 修改数据库路径为应用程序目录下的data文件夹

2. **`scripts/init-db.js`** - 数据库初始化脚本
   - 更新数据库路径配置

3. **`scripts/seed-data.js`** - 示例数据脚本
   - 更新数据库路径配置

4. **`.gitignore`** - 版本控制配置
   - 添加data目录的数据库文件排除规则
   - 保留.gitkeep文件以维持目录结构

5. **文档更新**
   - `README.md` - 更新数据库位置说明
   - `DEVELOPMENT.md` - 更新开发指南
   - `START.md` - 更新快速启动指南

## 🆕 新增文件

- **`data/.gitkeep`** - 保持data目录在版本控制中

## 💡 优势

### 移动性
- 整个应用程序可以作为一个完整的文件夹进行复制和移动
- 数据库文件与应用程序保持在一起

### 便携性
- 适合制作便携版应用程序
- 方便在不同计算机间迁移

### 备份管理
- 备份整个应用目录即可包含所有数据
- 简化了数据备份流程

## 🔧 使用说明

### 重新初始化数据库
```bash
npm run db:init
```

### 迁移现有数据
如果您已经在旧位置有数据，可以：

1. 找到旧数据库文件位置
2. 将 `database.db` 文件复制到项目的 `data/` 目录下
3. 重启应用程序

### 验证迁移
应用程序启动时会显示"数据库初始化完成"消息，表示新配置正常工作。

## ⚠️ 注意事项

1. **数据备份**: 在进行任何迁移操作前，请备份您的数据
2. **权限问题**: 确保应用程序对data目录有读写权限
3. **路径问题**: 在生产环境中，确保应用能够正确访问相对路径

## 🔍 故障排除

### 数据库文件不存在
- 运行 `npm run db:init` 重新初始化数据库

### 权限错误
- 检查data目录的读写权限
- 在Windows上可能需要以管理员身份运行

### 数据丢失
- 检查旧位置是否还有数据库文件
- 将旧文件复制到新位置

---

📅 **迁移日期**: 2025年9月7日  
✅ **状态**: 完成  
🏷️ **版本**: v1.0.0+
<template>
  <Layout>
    <div class="essay-grading-container">
      <!-- È°µÈù¢Â§¥ÈÉ® -->
      <div class="grading-header">
        <div class="header-left">
          <el-button @click="$router.back()" type="text">
            <el-icon><ArrowLeft /></el-icon>
            ËøîÂõû
          </el-button>
          <h2>‚úçÔ∏è ‰ΩúÊñáÊâπÊîπ</h2>
        </div>
        <div class="header-right">
          <el-button @click="showHistory = true" type="primary" plain>
            <el-icon><Clock /></el-icon>
            ÊâπÊîπËÆ∞ÂΩï
          </el-button>
          <el-button @click="showSettings = true" type="info" plain>
            <el-icon><Setting /></el-icon>
            ÊâπÊîπËÆæÁΩÆ
          </el-button>
        </div>
      </div>

      <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
      <div class="grading-content">
        <el-row :gutter="24">
          <!-- Â∑¶‰æßËæìÂÖ•Âå∫Âüü -->
          <el-col :span="12">
            <el-card class="input-card" shadow="hover">
              <template #header>
                <div class="card-header">
                  <span>üìù ‰ΩúÊñá‰ø°ÊÅØ</span>
                </div>
              </template>
              
              <el-form :model="essayForm" label-width="100px" :rules="formRules" ref="essayFormRef">
                <el-form-item label="‰ΩúÊñáÊ†áÈ¢ò" prop="title">
                  <el-input v-model="essayForm.title" placeholder="ËØ∑ËæìÂÖ•‰ΩúÊñáÊ†áÈ¢ò" />
                </el-form-item>
                
                <el-form-item label="Âπ¥Á∫ß" prop="grade">
                  <el-select v-model="essayForm.grade" placeholder="ÈÄâÊã©Âπ¥Á∫ß">
                    <el-option label="Â∞èÂ≠¶‰ΩéÂπ¥Á∫ß" value="primary_low" />
                    <el-option label="Â∞èÂ≠¶È´òÂπ¥Á∫ß" value="primary_high" />
                    <el-option label="Âàù‰∏≠" value="middle" />
                    <el-option label="È´ò‰∏≠" value="high" />
                  </el-select>
                </el-form-item>
                
                <el-form-item label="‰ΩúÊñáÁ±ªÂûã" prop="type">
                  <el-select v-model="essayForm.type" placeholder="ÈÄâÊã©‰ΩúÊñáÁ±ªÂûã">
                    <el-option label="ËÆ∞ÂèôÊñá" value="narrative" />
                    <el-option label="ËÆÆËÆ∫Êñá" value="argumentative" />
                    <el-option label="ËØ¥ÊòéÊñá" value="expository" />
                    <el-option label="Â∫îÁî®Êñá" value="practical" />
                    <el-option label="ËØóÊ≠å" value="poetry" />
                    <el-option label="Êï£Êñá" value="prose" />
                  </el-select>
                </el-form-item>
                
                <el-form-item label="Êª°ÂàÜ" prop="maxScore">
                  <el-input-number v-model="essayForm.maxScore" :min="50" :max="150" :step="10" />
                  <span style="margin-left: 8px; color: #909399;">ÂàÜ</span>
                </el-form-item>
                
                <el-form-item label="‰ΩúÊñáË¶ÅÊ±Ç">
                  <el-input 
                    v-model="essayForm.requirements" 
                    type="textarea" 
                    :rows="3" 
                    placeholder="ËØ∑ËæìÂÖ•‰ΩúÊñáË¶ÅÊ±Ç„ÄÅËØÑÂàÜÊ†áÂáÜÁ≠âÔºàÂèØÈÄâÔºâ"
                  />
                </el-form-item>
                
                <el-form-item label="‰ΩúÊñáÂÜÖÂÆπ" prop="content">
                  <el-input 
                    v-model="essayForm.content" 
                    type="textarea" 
                    :rows="12" 
                    placeholder="ËØ∑Á≤òË¥¥ÊàñËæìÂÖ•Â≠¶ÁîüÁöÑ‰ΩúÊñáÂÜÖÂÆπ..."
                    show-word-limit
                    maxlength="5000"
                  />
                </el-form-item>
              </el-form>
              
              <div class="action-buttons">
                <el-button type="primary" @click="gradeEssay" :loading="isGrading" size="large">
                  <el-icon><Edit /></el-icon>
                  ÂºÄÂßãÊâπÊîπ
                </el-button>
                <el-button @click="resetForm" size="large">
                  <el-icon><Refresh /></el-icon>
                  ÈáçÁΩÆ
                </el-button>
              </div>
            </el-card>
          </el-col>
          
          <!-- Âè≥‰æßÁªìÊûúÂå∫Âüü -->
          <el-col :span="12">
            <el-card class="result-card" shadow="hover">
              <template #header>
                <div class="card-header">
                  <span>üìä ÊâπÊîπÁªìÊûú</span>
                  <div v-if="gradingResult">
                    <el-button @click="saveResult" type="success" size="small">
                      <el-icon><Download /></el-icon>
                      ‰øùÂ≠ò
                    </el-button>
                    <el-button @click="exportResult" type="primary" size="small">
                      <el-icon><Document /></el-icon>
                      ÂØºÂá∫
                    </el-button>
                  </div>
                </div>
              </template>
              
              <div class="result-content">
                <div v-if="!gradingResult && !isGrading" class="empty-state">
                  <el-icon size="64" color="#C0C4CC"><Edit /></el-icon>
                  <p>ËØ∑Â°´ÂÜôÂ∑¶‰æß‰ΩúÊñá‰ø°ÊÅØÂπ∂ÁÇπÂáª"ÂºÄÂßãÊâπÊîπ"</p>
                </div>
                
                <div v-if="isGrading" class="grading-state">
                  <el-icon size="48" color="#409EFF" class="rotating"><Loading /></el-icon>
                  <p>AIÊ≠£Âú®‰ªîÁªÜÊâπÊîπ‰ΩúÊñáÔºåËØ∑Á®çÂÄô...</p>
                  <div class="grading-progress">
                    <el-progress :percentage="gradingProgress" :show-text="false" />
                    <span class="progress-text">{{ gradingSteps[currentStep] }}</span>
                  </div>
                </div>
                
                <div v-if="gradingResult" class="grading-content">
                  <!-- ÊÄª‰ΩìËØÑÂàÜ -->
                  <div class="score-section">
                    <div class="score-display">
                      <div class="score-number">{{ gradingResult.totalScore }}</div>
                      <div class="score-total">/ {{ essayForm.maxScore }}</div>
                    </div>
                    <div class="score-level">
                      <el-tag :type="getScoreType(gradingResult.totalScore, essayForm.maxScore)" size="large">
                        {{ getScoreLevel(gradingResult.totalScore, essayForm.maxScore) }}
                      </el-tag>
                    </div>
                  </div>
                  
                  <!-- ÂàÜÈ°πËØÑÂàÜ -->
                  <div class="detailed-scores">
                    <h3>üìã ÂàÜÈ°πËØÑÂàÜ</h3>
                    <div class="score-items">
                      <div v-for="item in gradingResult.detailedScores" :key="item.category" class="score-item">
                        <div class="item-name">{{ item.category }}</div>
                        <div class="item-score">
                          <el-progress 
                            :percentage="(item.score / item.maxScore) * 100" 
                            :color="getProgressColor(item.score / item.maxScore)"
                          />
                          <span class="score-text">{{ item.score }}/{{ item.maxScore }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- ‰ºòÁÇπ -->
                  <div class="feedback-section">
                    <h3>‚ú® ‰ºòÁÇπ</h3>
                    <div class="feedback-content positive">
                      <div v-html="formatFeedback(gradingResult.strengths)"></div>
                    </div>
                  </div>
                  
                  <!-- ÈúÄË¶ÅÊîπËøõÁöÑÂú∞Êñπ -->
                  <div class="feedback-section">
                    <h3>üîß ÈúÄË¶ÅÊîπËøõ</h3>
                    <div class="feedback-content improvement">
                      <div v-html="formatFeedback(gradingResult.improvements)"></div>
                    </div>
                  </div>
                  
                  <!-- ÂÖ∑‰ΩìÂª∫ËÆÆ -->
                  <div class="feedback-section">
                    <h3>üí° ÂÖ∑‰ΩìÂª∫ËÆÆ</h3>
                    <div class="feedback-content suggestions">
                      <div v-html="formatFeedback(gradingResult.suggestions)"></div>
                    </div>
                  </div>
                  
                  <!-- ÊÄªËØÑ -->
                  <div class="feedback-section">
                    <h3>üìù ÊÄªËØÑ</h3>
                    <div class="feedback-content summary">
                      <div v-html="formatFeedback(gradingResult.summary)"></div>
                    </div>
                  </div>
                </div>
              </div>
            </el-card>
          </el-col>
        </el-row>
      </div>

      <!-- ÊâπÊîπËÆ∞ÂΩïÂØπËØùÊ°Ü -->
      <el-dialog v-model="showHistory" title="ÊâπÊîπËÆ∞ÂΩï" width="80%" top="5vh">
        <div class="history-content">
          <div v-if="historyList.length === 0" class="empty-history">
            <el-empty description="ÊöÇÊó†ÊâπÊîπËÆ∞ÂΩï" />
          </div>
          <div v-else>
            <el-table :data="historyList" stripe>
              <el-table-column prop="title" label="‰ΩúÊñáÊ†áÈ¢ò" min-width="150" />
              <el-table-column prop="grade" label="Âπ¥Á∫ß" width="100">
                <template #default="{ row }">
                  <el-tag size="small">{{ getGradeName(row.grade) }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column prop="type" label="Á±ªÂûã" width="100">
                <template #default="{ row }">
                  <el-tag size="small" type="info">{{ getTypeName(row.type) }}</el-tag>
                </template>
              </el-table-column>
              <el-table-column prop="total_score" label="ÂæóÂàÜ" width="100">
                <template #default="{ row }">
                  <span class="score-display-small">{{ row.total_score }}/{{ row.max_score }}</span>
                </template>
              </el-table-column>
              <el-table-column prop="created_at" label="ÊâπÊîπÊó∂Èó¥" width="150">
                <template #default="{ row }">
                  {{ formatDate(row.created_at) }}
                </template>
              </el-table-column>
              <el-table-column label="Êìç‰Ωú" width="150">
                <template #default="{ row }">
                  <el-button size="small" type="primary" @click="loadHistoryItem(row)">
                    Êü•Áúã
                  </el-button>
                  <el-button size="small" type="danger" @click="deleteHistoryItem(row.id)">
                    Âà†Èô§
                  </el-button>
                </template>
              </el-table-column>
            </el-table>
          </div>
        </div>
      </el-dialog>

      <!-- ÊâπÊîπËÆæÁΩÆÂØπËØùÊ°Ü -->
      <el-dialog v-model="showSettings" title="ÊâπÊîπËÆæÁΩÆ" width="500px">
        <el-form :model="gradingSettings" label-width="120px">
          <el-form-item label="ÊâπÊîπ‰∏•Ê†ºÁ®ãÂ∫¶">
            <el-radio-group v-model="gradingSettings.strictness">
              <el-radio label="lenient">ÂÆΩÊùæ</el-radio>
              <el-radio label="moderate">ÈÄÇ‰∏≠</el-radio>
              <el-radio label="strict">‰∏•Ê†º</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item label="ÈáçÁÇπÂÖ≥Ê≥®">
            <el-checkbox-group v-model="gradingSettings.focusAreas">
              <el-checkbox label="content">ÂÜÖÂÆπ</el-checkbox>
              <el-checkbox label="structure">ÁªìÊûÑ</el-checkbox>
              <el-checkbox label="language">ËØ≠Ë®Ä</el-checkbox>
              <el-checkbox label="creativity">ÂàõÊÑè</el-checkbox>
            </el-checkbox-group>
          </el-form-item>
          <el-form-item label="ÂèçÈ¶àËØ¶ÁªÜÁ®ãÂ∫¶">
            <el-slider v-model="gradingSettings.detailLevel" :min="1" :max="5" show-stops />
          </el-form-item>
        </el-form>
        <template #footer>
          <el-button @click="showSettings = false">ÂèñÊ∂à</el-button>
          <el-button type="primary" @click="saveSettings">‰øùÂ≠ò</el-button>
        </template>
      </el-dialog>
    </div>
  </Layout>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { 
  ArrowLeft, 
  Clock, 
  Setting, 
  Edit, 
  Refresh, 
  Download, 
  Document, 
  Loading 
} from '@element-plus/icons-vue'
import Layout from '../Layout.vue'

interface EssayForm {
  title: string
  grade: string
  type: string
  maxScore: number
  requirements: string
  content: string
}

interface DetailedScore {
  category: string
  score: number
  maxScore: number
}

interface GradingResult {
  totalScore: number
  detailedScores: DetailedScore[]
  strengths: string
  improvements: string
  suggestions: string
  summary: string
}

interface GradingSettings {
  strictness: string
  focusAreas: string[]
  detailLevel: number
}

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const essayForm = reactive<EssayForm>({
  title: '',
  grade: '',
  type: '',
  maxScore: 100,
  requirements: '',
  content: ''
})

const gradingResult = ref<GradingResult | null>(null)
const isGrading = ref(false)
const gradingProgress = ref(0)
const currentStep = ref(0)
const showHistory = ref(false)
const showSettings = ref(false)
const historyList = ref([])
const essayFormRef = ref()

// ÊâπÊîπËÆæÁΩÆ
const gradingSettings = reactive<GradingSettings>({
  strictness: 'moderate',
  focusAreas: ['content', 'structure', 'language'],
  detailLevel: 3
})

// ÊâπÊîπÊ≠•È™§
const gradingSteps = [
  'Ê≠£Âú®ÂàÜÊûê‰ΩúÊñáÁªìÊûÑ...',
  'Ê≠£Âú®ËØÑ‰º∞ÂÜÖÂÆπË¥®Èáè...',
  'Ê≠£Âú®Ê£ÄÊü•ËØ≠Ë®ÄË°®Ëææ...',
  'Ê≠£Âú®ÁîüÊàêÊîπËøõÂª∫ËÆÆ...',
  'Ê≠£Âú®ÂÆåÊàêÊúÄÁªàËØÑÂàÜ...'
]

// Ë°®ÂçïÈ™åËØÅËßÑÂàô
const formRules = {
  title: [{ required: true, message: 'ËØ∑ËæìÂÖ•‰ΩúÊñáÊ†áÈ¢ò', trigger: 'blur' }],
  grade: [{ required: true, message: 'ËØ∑ÈÄâÊã©Âπ¥Á∫ß', trigger: 'change' }],
  type: [{ required: true, message: 'ËØ∑ÈÄâÊã©‰ΩúÊñáÁ±ªÂûã', trigger: 'change' }],
  content: [{ required: true, message: 'ËØ∑ËæìÂÖ•‰ΩúÊñáÂÜÖÂÆπ', trigger: 'blur' }]
}

// ÊâπÊîπ‰ΩúÊñá
const gradeEssay = async () => {
  if (!essayFormRef.value) return
  
  try {
    await essayFormRef.value.validate()
    
    isGrading.value = true
    gradingProgress.value = 0
    currentStep.value = 0
    
    // Ê®°ÊãüÊâπÊîπËøõÂ∫¶
    const progressInterval = setInterval(() => {
      if (gradingProgress.value < 90) {
        gradingProgress.value += Math.random() * 15
        if (gradingProgress.value > 20 && currentStep.value === 0) currentStep.value = 1
        if (gradingProgress.value > 40 && currentStep.value === 1) currentStep.value = 2
        if (gradingProgress.value > 60 && currentStep.value === 2) currentStep.value = 3
        if (gradingProgress.value > 80 && currentStep.value === 3) currentStep.value = 4
      }
    }, 500)
    
    const response = await window.electronAPI.invoke('ai:gradeEssay', {
      ...essayForm,
      settings: gradingSettings
    })
    
    clearInterval(progressInterval)
    gradingProgress.value = 100
    
    if (response.success) {
      gradingResult.value = response.data
      ElMessage.success('‰ΩúÊñáÊâπÊîπÂÆåÊàêÔºÅ')
    } else {
      ElMessage.error(response.message || 'ÊâπÊîπÂ§±Ë¥•')
    }
  } catch (error) {
    console.error('ÊâπÊîπ‰ΩúÊñáÂ§±Ë¥•:', error)
    ElMessage.error('ÊâπÊîπÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•')
  } finally {
    isGrading.value = false
  }
}

// ÈáçÁΩÆË°®Âçï
const resetForm = () => {
  Object.assign(essayForm, {
    title: '',
    grade: '',
    type: '',
    maxScore: 100,
    requirements: '',
    content: ''
  })
  gradingResult.value = null
  if (essayFormRef.value) {
    essayFormRef.value.clearValidate()
  }
}

// ‰øùÂ≠òÁªìÊûú
const saveResult = async () => {
  if (!gradingResult.value) return
  
  try {
    const response = await window.electronAPI.invoke('ai:saveEssayGrading', {
      ...essayForm,
      result: gradingResult.value
    })
    
    if (response.success) {
      ElMessage.success('ÊâπÊîπÁªìÊûúÂ∑≤‰øùÂ≠ò')
      loadHistory()
    } else {
      ElMessage.error(response.message || '‰øùÂ≠òÂ§±Ë¥•')
    }
  } catch (error) {
    console.error('‰øùÂ≠òÁªìÊûúÂ§±Ë¥•:', error)
    ElMessage.error('‰øùÂ≠òÂ§±Ë¥•')
  }
}

// ÂØºÂá∫ÁªìÊûú
const exportResult = async () => {
  if (!gradingResult.value) return
  
  try {
    const response = await window.electronAPI.invoke('ai:exportEssayGrading', {
      ...essayForm,
      result: gradingResult.value
    })
    
    if (response.success) {
      ElMessage.success('ÊâπÊîπÁªìÊûúÂ∑≤ÂØºÂá∫')
    } else {
      ElMessage.error(response.message || 'ÂØºÂá∫Â§±Ë¥•')
    }
  } catch (error) {
    console.error('ÂØºÂá∫ÁªìÊûúÂ§±Ë¥•:', error)
    ElMessage.error('ÂØºÂá∫Â§±Ë¥•')
  }
}

// ‰øùÂ≠òËÆæÁΩÆ
const saveSettings = async () => {
  try {
    await window.electronAPI.invoke('ai:updateGradingSettings', gradingSettings)
    showSettings.value = false
    ElMessage.success('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò')
  } catch (error) {
    console.error('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:', error)
    ElMessage.error('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•')
  }
}

// Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
const loadHistory = async () => {
  try {
    const response = await window.electronAPI.invoke('ai:getEssayGradingHistory')
    if (response.success) {
      historyList.value = response.data
    }
  } catch (error) {
    console.error('Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', error)
  }
}

// Âä†ËΩΩÂéÜÂè≤È°πÁõÆ
const loadHistoryItem = (item: any) => {
  Object.assign(essayForm, {
    title: item.title,
    grade: item.grade,
    type: item.type,
    maxScore: item.max_score,
    requirements: item.requirements,
    content: item.content
  })
  
  try {
    gradingResult.value = JSON.parse(item.result_data)
  } catch (error) {
    console.error('Ëß£ÊûêÂéÜÂè≤Êï∞ÊçÆÂ§±Ë¥•:', error)
  }
  
  showHistory.value = false
}

// Âà†Èô§ÂéÜÂè≤È°πÁõÆ
const deleteHistoryItem = async (id: number) => {
  try {
    await ElMessageBox.confirm('Á°ÆÂÆöÂà†Èô§ËøôÊù°ÊâπÊîπËÆ∞ÂΩïÂêóÔºü', 'Á°ÆËÆ§Âà†Èô§', {
      type: 'warning'
    })
    
    const response = await window.electronAPI.invoke('ai:deleteEssayGrading', id)
    if (response.success) {
      ElMessage.success('Âà†Èô§ÊàêÂäü')
      loadHistory()
    } else {
      ElMessage.error(response.message || 'Âà†Èô§Â§±Ë¥•')
    }
  } catch (error) {
    // Áî®Êà∑ÂèñÊ∂àÂà†Èô§
  }
}

// Â∑•ÂÖ∑ÂáΩÊï∞
const getScoreType = (score: number, maxScore: number) => {
  const percentage = score / maxScore
  if (percentage >= 0.9) return 'success'
  if (percentage >= 0.8) return 'primary'
  if (percentage >= 0.7) return 'warning'
  return 'danger'
}

const getScoreLevel = (score: number, maxScore: number) => {
  const percentage = score / maxScore
  if (percentage >= 0.9) return '‰ºòÁßÄ'
  if (percentage >= 0.8) return 'ËâØÂ•Ω'
  if (percentage >= 0.7) return '‰∏≠Á≠â'
  if (percentage >= 0.6) return 'ÂèäÊ†º'
  return 'ÈúÄÂä™Âäõ'
}

const getProgressColor = (percentage: number) => {
  if (percentage >= 0.8) return '#67C23A'
  if (percentage >= 0.6) return '#E6A23C'
  return '#F56C6C'
}

const formatFeedback = (content: string) => {
  if (!content) return ''
  return content
    .replace(/\n/g, '<br>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/^(\d+\.)\s/gm, '<strong>$1</strong> ')
}

const formatDate = (dateStr: string) => {
  return new Date(dateStr).toLocaleString('zh-CN')
}

const getGradeName = (grade: string) => {
  const names = {
    primary_low: 'Â∞èÂ≠¶‰ΩéÂπ¥Á∫ß',
    primary_high: 'Â∞èÂ≠¶È´òÂπ¥Á∫ß',
    middle: 'Âàù‰∏≠',
    high: 'È´ò‰∏≠'
  }
  return names[grade as keyof typeof names] || grade
}

const getTypeName = (type: string) => {
  const names = {
    narrative: 'ËÆ∞ÂèôÊñá',
    argumentative: 'ËÆÆËÆ∫Êñá',
    expository: 'ËØ¥ÊòéÊñá',
    practical: 'Â∫îÁî®Êñá',
    poetry: 'ËØóÊ≠å',
    prose: 'Êï£Êñá'
  }
  return names[type as keyof typeof names] || type
}

// Âä†ËΩΩËÆæÁΩÆ
const loadSettings = async () => {
  try {
    const response = await window.electronAPI.invoke('ai:getGradingSettings')
    if (response.success) {
      Object.assign(gradingSettings, response.data)
    }
  } catch (error) {
    console.error('Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', error)
  }
}

onMounted(() => {
  loadHistory()
  loadSettings()
})
</script>

<style scoped>
.essay-grading-container {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f5f7fa;
}

.grading-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  background: white;
  border-bottom: 1px solid #e4e7ed;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-left h2 {
  margin: 0;
  font-size: 20px;
  color: #303133;
}

.header-right {
  display: flex;
  gap: 12px;
}

.grading-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
}

.input-card, .result-card {
  height: calc(100vh - 140px);
  overflow-y: auto;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  color: #303133;
}

.action-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 24px;
}

.result-content {
  height: calc(100% - 60px);
}

.empty-state, .grading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 300px;
  color: #909399;
}

.grading-state p {
  margin: 16px 0;
  font-size: 16px;
}

.grading-progress {
  width: 200px;
  text-align: center;
}

.progress-text {
  margin-top: 8px;
  font-size: 14px;
  color: #606266;
}

.rotating {
  animation: rotate 2s linear infinite;
}

.grading-content {
  padding: 16px 0;
}

.score-section {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
  padding: 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  color: white;
  margin-bottom: 24px;
}

.score-display {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.score-number {
  font-size: 48px;
  font-weight: bold;
}

.score-total {
  font-size: 24px;
  opacity: 0.8;
}

.detailed-scores {
  margin-bottom: 24px;
}

.detailed-scores h3 {
  color: #303133;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 2px solid #f0f0f0;
}

.score-items {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.score-item {
  display: flex;
  align-items: center;
  gap: 16px;
}

.item-name {
  width: 80px;
  font-weight: 500;
  color: #606266;
}

.item-score {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
}

.score-text {
  min-width: 60px;
  text-align: right;
  font-weight: 500;
  color: #303133;
}

.feedback-section {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #f0f0f0;
}

.feedback-section:last-child {
  border-bottom: none;
}

.feedback-section h3 {
  color: #303133;
  font-size: 16px;
  margin: 0 0 12px 0;
  padding: 8px 12px;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #409EFF;
}

.feedback-content {
  padding: 12px 16px;
  border-radius: 8px;
  line-height: 1.8;
}

.feedback-content.positive {
  background: #f0f9ff;
  border-left: 4px solid #67C23A;
  color: #529b2e;
}

.feedback-content.improvement {
  background: #fef0f0;
  border-left: 4px solid #F56C6C;
  color: #c45656;
}

.feedback-content.suggestions {
  background: #fdf6ec;
  border-left: 4px solid #E6A23C;
  color: #b88230;
}

.feedback-content.summary {
  background: #f4f4f5;
  border-left: 4px solid #909399;
  color: #606266;
}

.history-content {
  max-height: 60vh;
  overflow-y: auto;
}

.empty-history {
  text-align: center;
  padding: 40px;
}

.score-display-small {
  font-weight: 600;
  color: #409EFF;
}

@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (max-width: 768px) {
  .grading-content {
    padding: 16px;
  }
  
  .grading-content .el-row {
    flex-direction: column;
  }
  
  .grading-content .el-col {
    width: 100%;
    margin-bottom: 16px;
  }
  
  .input-card, .result-card {
    height: auto;
  }
  
  .score-section {
    flex-direction: column;
    gap: 16px;
  }
  
  .score-number {
    font-size: 36px;
  }
}
</style>